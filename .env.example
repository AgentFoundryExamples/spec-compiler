# Application Environment
# Valid values: development, staging, production
APP_ENV=development

# Server Configuration
PORT=8080

# API Keys (DO NOT commit real secrets)
# OpenAI API key for GPT models
OPENAI_API_KEY=sk-your-openai-key-here

# Anthropic API key for Claude models
CLAUDE_API_KEY=sk-ant-your-claude-key-here

# Google Cloud Configuration
# GCP Project ID for Cloud resources
GCP_PROJECT_ID=your-gcp-project-id

# Pub/Sub topic for plan status updates
PUBSUB_TOPIC_PLAN_STATUS=plan-status-topic

# Downstream log sink for Cloud Logging
DOWNSTREAM_LOG_SINK=projects/your-project/logs/app-logs

# CORS Configuration
# Comma-separated list of allowed origins (leave empty to disable CORS)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Application Version
# Git SHA or semantic version
APP_VERSION=0.1.0

# Request ID Header
# Header name for request correlation
REQUEST_ID_HEADER=X-Request-Id

# Logging Configuration
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable JSON structured logging (true for Cloud Run)
LOG_JSON=true

# Request Body Limits
# Maximum request body size in bytes (default: 10485760 = 10MB)
MAX_REQUEST_BODY_SIZE_BYTES=10485760

# Idempotency Configuration
# Maximum length for idempotency keys (default: 100)
# Keys exceeding this length are truncated for security
MAX_IDEMPOTENCY_KEY_LENGTH=100

# GitHub API Configuration
# Base URL for GitHub REST API (defaults to public GitHub)
# For GitHub Enterprise, use your custom domain: https://github.yourcompany.com/api/v3
GITHUB_API_BASE_URL=https://api.github.com

# GitHub Token Minting Service Configuration
# **REQUIRED** for compile endpoint to fetch repository context from GitHub
# Base URL for the token minting service (typically a Cloud Run service URL)
# Example: https://github-token-service-xxxxx-uc.a.run.app
# Without this configured, compile requests will fail with HTTP 500
# The service fetches tree.json, dependencies.json, and file-summaries.json
# from .github/repo-analysis-output/ in the target repository
MINTING_SERVICE_BASE_URL=

# Optional authorization header for minting service authentication
# For Cloud Run IAM auth, provide a GCP identity token
# Obtain via: gcloud auth print-identity-token
# Or via service account: google.oauth2.id_token.fetch_id_token()
# Leave empty if minting service doesn't require authentication
MINTING_SERVICE_AUTH_HEADER=

# GitHub Repository Context Fallback Behavior
# When fetching repository analysis files (.github/repo-analysis-output/):
# - Missing files (404): Uses fallback placeholder data, logs warning, continues
# - Malformed JSON: Uses fallback placeholder data, logs warning, continues  
# - GitHub API errors (403, 500, etc.): Uses fallback placeholder data, logs warning, continues
# - All files missing: Compile request succeeds with all fallback data
# - Token minting failure: Returns HTTP 5xx based on error type:
#   * 500 Internal Server Error: Minting service not configured (MINTING_SERVICE_BASE_URL missing)
#   * 502 Bad Gateway: Minting service returned 4xx error (client error)
#   * 503 Service Unavailable: Minting service returned 5xx error (temporary failure)
# Fallback ensures compilation can proceed even with incomplete repository context

# GitHub Token Caching
# Tokens are cached in-memory by default to reduce minting service calls
# Cache respects token expiry with a 5-minute safety buffer
# Clear cache programmatically via GitHubAuthClient.clear_cache(owner, repo)
# Disable caching by setting enable_caching=False in GitHubAuthClient constructor
