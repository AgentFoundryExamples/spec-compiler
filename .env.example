# Application Environment
# Valid values: development, staging, production
APP_ENV=development

# Server Configuration
PORT=8080

# API Keys (DO NOT commit real secrets)
# OpenAI API key for GPT models
OPENAI_API_KEY=sk-your-openai-key-here

# Anthropic API key for Claude models
CLAUDE_API_KEY=sk-ant-your-claude-key-here

# LLM Configuration
# LLM provider to use for spec compilation (openai|anthropic)
# Default: openai
# Valid values: openai, anthropic
# This setting determines which LLM service to call for compilation requests
LLM_PROVIDER=openai

# OpenAI model to use when LLM_PROVIDER=openai
# Default: gpt-5.1
# Recommended: gpt-5.1 (uses Responses API, see LLMs.md)
OPENAI_MODEL=gpt-5.1

# Anthropic Claude model to use when LLM_PROVIDER=anthropic
# Default: claude-3-5-sonnet-20241022
# Recommended: claude-3-5-sonnet-20241022 (Claude 3.5 Sonnet, uses Messages API, see LLMs.md)
CLAUDE_MODEL=claude-3-5-sonnet-20241022

# Path to system prompt file (optional)
# If not set, uses a built-in default prompt
# Can be absolute or relative path
# Example: /app/prompts/system.txt or ./prompts/system.txt
# The file should contain plain text prompt content
# Large prompts are cached after first load for performance
SYSTEM_PROMPT_PATH=

# LLM Stub Mode (true|false)
# Default: false
# When true, bypasses actual LLM API calls and returns stubbed responses
# Useful for testing, local development without API keys, or CI/CD pipelines
# Set to 'true' to enable, 'false' to disable
LLM_STUB_MODE=false

# Google Cloud Configuration
# GCP Project ID for Cloud resources
# **REQUIRED** for Pub/Sub status publishing
# Example: my-project-id
GCP_PROJECT_ID=your-gcp-project-id

# Pub/Sub topic for plan status updates
# **REQUIRED** for status publishing to plan-scheduler
# Topic name must exist in the GCP project specified above
# Messages conform to PlanStatusMessage schema (see plan-scheduler.openapi.json)
# Status flow: spec-compiler publishes -> plan-scheduler consumes
# Allowed status values: in_progress, succeeded, failed
# Example: plan-status-updates
PUBSUB_TOPIC_PLAN_STATUS=plan-status-topic

# Optional path to GCP service account credentials JSON file
# If not set, uses Application Default Credentials (ADC)
# ADC sources (in order): GOOGLE_APPLICATION_CREDENTIALS env var, gcloud auth, Compute Engine/Cloud Run metadata
# Only needed for local development or when ADC is not available
# Example: /path/to/service-account-key.json or ./credentials/gcp-sa.json
PUBSUB_CREDENTIALS_PATH=

# Downstream log sink for Cloud Logging
DOWNSTREAM_LOG_SINK=projects/your-project/logs/app-logs

# CORS Configuration
# Comma-separated list of allowed origins (leave empty to disable CORS)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Application Version
# Git SHA or semantic version
APP_VERSION=0.1.0

# Request ID Header
# Header name for request correlation
REQUEST_ID_HEADER=X-Request-Id

# Logging Configuration
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable JSON structured logging (true for Cloud Run)
LOG_JSON=true

# Request Body Limits
# Maximum request body size in bytes (default: 10485760 = 10MB)
MAX_REQUEST_BODY_SIZE_BYTES=10485760

# Idempotency Configuration
# Maximum length for idempotency keys (default: 100)
# Keys exceeding this length are truncated for security
MAX_IDEMPOTENCY_KEY_LENGTH=100

# GitHub API Configuration
# Base URL for GitHub REST API (defaults to public GitHub)
# For GitHub Enterprise, use your custom domain: https://github.yourcompany.com/api/v3
GITHUB_API_BASE_URL=https://api.github.com

# GitHub Token Minting Service Configuration
# **REQUIRED** for compile endpoint to fetch repository context from GitHub
# Base URL for the token minting service (typically a Cloud Run service URL)
# Example: https://github-token-service-xxxxx-uc.a.run.app
# Without this configured, compile requests will fail with HTTP 500
# The service fetches tree.json, dependencies.json, and file-summaries.json
# from .github/repo-analysis-output/ in the target repository
MINTING_SERVICE_BASE_URL=

# Optional authorization header for minting service authentication
# For Cloud Run IAM auth, provide a GCP identity token
# Obtain via: gcloud auth print-identity-token
# Or via service account: google.oauth2.id_token.fetch_id_token()
# Leave empty if minting service doesn't require authentication
MINTING_SERVICE_AUTH_HEADER=

# GitHub Repository Context Fallback Behavior
# When fetching repository analysis files (.github/repo-analysis-output/):
# - Missing files (404): Uses fallback placeholder data, logs warning, continues
# - Malformed JSON: Uses fallback placeholder data, logs warning, continues  
# - GitHub API errors (403, 500, etc.): Uses fallback placeholder data, logs warning, continues
# - All files missing: Compile request succeeds with all fallback data
# - Token minting failure: Returns HTTP 5xx based on error type:
#   * 500 Internal Server Error: Minting service not configured (MINTING_SERVICE_BASE_URL missing)
#   * 502 Bad Gateway: Minting service returned 4xx error (client error)
#   * 503 Service Unavailable: Minting service returned 5xx error (temporary failure)
# Fallback ensures compilation can proceed even with incomplete repository context

# GitHub Token Caching
# Tokens are cached in-memory by default to reduce minting service calls
# Cache respects token expiry with a 5-minute safety buffer
# Clear cache programmatically via GitHubAuthClient.clear_cache(owner, repo)
# Disable caching by setting enable_caching=False in GitHubAuthClient constructor
